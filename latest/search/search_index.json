{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Overview","text":"ustraj <p>A collection of scripts for analysing trajectory files collected during US simulations</p> <p> </p> <p>The <code>ustraj</code> framework ...</p>"},{"location":"#installation","title":"Installation","text":"<p>This package can be installed using <code>conda</code> (or <code>mamba</code>, a faster version of <code>conda</code>):</p> <pre><code>mamba install -c conda-forge ustraj\n</code></pre>"},{"location":"#getting-started","title":"Getting Started","text":"<p>To get started, see the documentation.</p>"},{"location":"development/","title":"Development","text":"<p>To create a development environment, you must have <code>mamba</code> installed.</p> <p>A development conda environment can be created and activated with:</p> <pre><code>make env\nconda activate ustraj\n</code></pre> <p>To format the codebase:</p> <pre><code>make format\n</code></pre> <p>To run the unit tests:</p> <pre><code>make test\n</code></pre> <p>To serve the documentation locally:</p> <pre><code>mkdocs serve\n</code></pre>"},{"location":"reference/","title":"Index","text":""},{"location":"reference/#ustraj","title":"ustraj","text":"<p>A collection of scripts for analysing trajectory files collected during US simulations</p> <p>Modules:</p> <ul> <li> <code>analysis</code>           \u2013            <p>Functions to analyse US trajectory files</p> </li> </ul> <p>Functions:</p> <ul> <li> <code>count_hbonds</code>             \u2013              <p>Calculate the number of hydrogen bonds formed to a specific residue during</p> </li> <li> <code>calc_solvent_rdf</code>             \u2013              <p>Calculate the solvent RDF around an atom of interest</p> </li> <li> <code>calc_RMSD</code>             \u2013              <p>Calculate the RMSD for a region of interest</p> </li> <li> <code>calc_closest_distance</code>             \u2013              <p>Calculate closest distance between two sets of residues</p> </li> <li> <code>calc_hbond_distance</code>             \u2013              <p>Calculate closest distance between two sets of residues</p> </li> </ul>"},{"location":"reference/#ustraj.count_hbonds","title":"count_hbonds","text":"<pre><code>count_hbonds(\n    residue_index,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    sidechain_only=True,\n    step=10,\n    solvent_only=False,\n)\n</code></pre> <p>Calculate the number of hydrogen bonds formed to a specific residue during the course of a certain trajectory file.</p>"},{"location":"reference/#ustraj.count_hbonds--parameters","title":"Parameters","text":"<p>residue_index : int     Residue of interest for hydrogen bonding analysis prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. run_number : int     The desired replicate CV0 : float     The US bias minimum sidechain_only : bool, optional, default=True     Only use the sidechain of the residue step : int, optional, default=10     Step to use when analysing the frames, makes analysis quicker solvent_only: bool, optional, default=False     Only consider H-bonding to solvent</p>"},{"location":"reference/#ustraj.count_hbonds--returns","title":"Returns","text":"<p>donor_data: dict     Dictionary containing information about the residue of interest being     involved as a hydrogen bond donor. acceptor_data: dict     Dictionary containing information about the residue of interest being     involved as a hydrogen bond acceptor.</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def count_hbonds(\n    residue_index,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    sidechain_only=True,\n    step=10,\n    solvent_only=False,\n):\n    \"\"\"\n    Calculate the number of hydrogen bonds formed to a specific residue during\n    the course of a certain trajectory file.\n\n    Parameters\n    ----------\n    residue_index : int\n        Residue of interest for hydrogen bonding analysis\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    run_number : int\n        The desired replicate\n    CV0 : float\n        The US bias minimum\n    sidechain_only : bool, optional, default=True\n        Only use the sidechain of the residue\n    step : int, optional, default=10\n        Step to use when analysing the frames, makes analysis quicker\n    solvent_only: bool, optional, default=False\n        Only consider H-bonding to solvent\n\n    Returns\n    -------\n    donor_data: dict\n        Dictionary containing information about the residue of interest being\n        involved as a hydrogen bond donor.\n    acceptor_data: dict\n        Dictionary containing information about the residue of interest being\n        involved as a hydrogen bond acceptor.\n\n    \"\"\"\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n\n    water_sel = \"resname WAT\"\n    res_id = f\"resid {residue_index}\"\n\n    # residue atoms to consider (sidechain vs whole residue)\n    res_sel = f\"({res_id}) and not backbone\" if sidechain_only else f\"({res_id})\"\n\n    partner_sel = (\n        f\"not ({res_id})\"  # exclude the whole residue regardless of sidechain_only\n    )\n\n    # Residue acting as donor\n    hydrogens0 = f\"({res_sel}) and name H*\"\n    acceptors0 = f\"({partner_sel}) and (name O* or name N* or name S*)\"\n\n    # Residue acting as acceptor\n    hydrogens1 = f\"({partner_sel}) and name H*\"\n    acceptors1 = f\"({res_sel}) and (name O* or name N* or name S*)\"\n\n    if solvent_only:\n        acceptors0 += f\" and ({water_sel})\"\n        hydrogens1 += f\" and ({water_sel})\"\n\n    # Identify possible donor interactions\n    h0 = _HBA(\n        u,\n        hydrogens_sel=hydrogens0,\n        acceptors_sel=acceptors0,\n    )\n    h0.run(start=0, stop=None, step=step, verbose=True)\n\n    # Identify possible acceptor interactions\n    h1 = _HBA(\n        u,\n        hydrogens_sel=hydrogens1,\n        acceptors_sel=acceptors1,\n    )\n    h1.run(start=0, stop=None, step=step, verbose=True)\n\n    # Find simulation time\n    t_final = _np.round(u.trajectory[-1].time / 1000, 4)\n    time = _np.linspace(0, t_final, len(h0.count_by_time()))\n\n    donor_data = {\n        \"Time (ns)\": time,\n        \"Count by time\": h0.count_by_time(),\n        \"Count by ID\": h0.count_by_ids(),\n        \"Count by type\": h0.count_by_type(),\n    }\n\n    acceptor_data = {\n        \"Time (ns)\": time,\n        \"Count by time\": h1.count_by_time(),\n        \"Count by ID\": h1.count_by_ids(),\n        \"Count by type\": h1.count_by_type(),\n    }\n\n    return donor_data, acceptor_data\n</code></pre>"},{"location":"reference/#ustraj.calc_solvent_rdf","title":"calc_solvent_rdf","text":"<pre><code>calc_solvent_rdf(\n    atom_index,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    step=10,\n)\n</code></pre> <p>Calculate the solvent RDF around an atom of interest</p>"},{"location":"reference/#ustraj.calc_solvent_rdf--parameters","title":"Parameters","text":"<p>atom_index : int     Atom used to compute the RDF prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. run_number : int     The desired replicate CV0 : float     The US bias minimum step : int, optional, default=10     Step to use when analysing the frames, makes analysis quicker</p>"},{"location":"reference/#ustraj.calc_solvent_rdf--returns","title":"Returns","text":"<p>distance : np.ndarray     Radial separation distance in Angstroms rdf: np.ndarray     Normalised RDF around the specified atom</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def calc_solvent_rdf(\n    atom_index,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    step=10,\n):\n    \"\"\"\n    Calculate the solvent RDF around an atom of interest\n\n    Parameters\n    ----------\n    atom_index : int\n        Atom used to compute the RDF\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    run_number : int\n        The desired replicate\n    CV0 : float\n        The US bias minimum\n    step : int, optional, default=10\n        Step to use when analysing the frames, makes analysis quicker\n\n    Returns\n    -------\n    distance : np.ndarray\n        Radial separation distance in Angstroms\n    rdf: np.ndarray\n        Normalised RDF around the specified atom\n\n    \"\"\"\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n\n    selected_atom = u.select_atoms(f\"index {atom_index}\")\n    solvent = u.select_atoms(\"resname WAT\")\n\n    rdf = _InterRDF(selected_atom, solvent)\n    rdf.run(step=step, verbose=True)\n\n    return rdf.bins, rdf.rdf\n</code></pre>"},{"location":"reference/#ustraj.calc_RMSD","title":"calc_RMSD","text":"<pre><code>calc_RMSD(\n    resid_selection,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    step=1,\n    selection_str=\"backbone\",\n    u_ref=None,\n)\n</code></pre> <p>Calculate the RMSD for a region of interest</p>"},{"location":"reference/#ustraj.calc_RMSD--parameters","title":"Parameters","text":"<p>resid_selection : np.ndarray     Selection of residue indices to include in the RMSD calculation prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. run_number : int     The desired replicate CV0 : float     The US bias minimum step : int, optional, default=1     Step to use when analysing the frames, makes analysis quicker selection_str : str, optional, default='backbone'     Atoms to include during alignment and RMSD calculation u_ref : mda.Universe object, optional, default=None     Reference universe to use for alignment and RMSD calculation.     If 'None' is specified, the first frame is used</p>"},{"location":"reference/#ustraj.calc_RMSD--returns","title":"Returns","text":"<p>time : np.ndarray     Time in ns rmsd: np.ndarray     RMSD as a timeseries</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def calc_RMSD(\n    resid_selection,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    step=1,\n    selection_str='backbone',\n    u_ref=None\n):\n    \"\"\"\n    Calculate the RMSD for a region of interest\n\n    Parameters\n    ----------\n    resid_selection : np.ndarray\n        Selection of residue indices to include in the RMSD calculation\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    run_number : int\n        The desired replicate\n    CV0 : float\n        The US bias minimum\n    step : int, optional, default=1\n        Step to use when analysing the frames, makes analysis quicker\n    selection_str : str, optional, default='backbone'\n        Atoms to include during alignment and RMSD calculation\n    u_ref : mda.Universe object, optional, default=None\n        Reference universe to use for alignment and RMSD calculation.\n        If 'None' is specified, the first frame is used\n\n    Returns\n    -------\n    time : np.ndarray\n        Time in ns\n    rmsd: np.ndarray\n        RMSD as a timeseries\n    \"\"\"\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n\n    # Add specific residue indices to selection string\n    selection_str += \" and resid \" + \" \".join(str(r) for r in resid_selection)\n\n    selection = u.select_atoms(selection_str)\n\n    if u_ref is not None:\n        ref = u_ref.select_atoms(selection_str)\n        if ref.n_atoms != selection.n_atoms:\n            raise ValueError(\n                \"Reference and mobile selections have different number of atoms.\"\n            )\n    else:\n        ref = selection\n\n    R = _rms.RMSD(selection, ref,\n    superposition=True)\n\n    R.run(step=step)\n\n    rmsd = R.rmsd.T # transpose\n\n    return rmsd[1]/1000, rmsd[2] # time in ns, rmsd\n</code></pre>"},{"location":"reference/#ustraj.calc_closest_distance","title":"calc_closest_distance","text":"<pre><code>calc_closest_distance(\n    resids0,\n    resids1,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    selection_str=\"name CA\",\n)\n</code></pre> <p>Calculate closest distance between two sets of residues</p>"},{"location":"reference/#ustraj.calc_closest_distance--parameters","title":"Parameters","text":"<p>resids0 : np.ndarray     Residue group 0 resids1 : np.ndarray     Residue group 1 prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. CV0 : float     The US bias minimum run_number : int     The desired replicate selection_str : str, optional, default='name CA'     Atoms to include in the distance calculations</p>"},{"location":"reference/#ustraj.calc_closest_distance--returns","title":"Returns","text":"<p>time : np.ndarray     Time in ns distance: np.ndarray     Closest distance between the two selections over time</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def calc_closest_distance(\n    resids0,\n    resids1,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    selection_str='name CA'\n):\n    \"\"\"\n    Calculate closest distance between two sets of residues\n\n    Parameters\n    ----------\n    resids0 : np.ndarray\n        Residue group 0\n    resids1 : np.ndarray\n        Residue group 1\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    CV0 : float\n        The US bias minimum\n    run_number : int\n        The desired replicate\n    selection_str : str, optional, default='name CA'\n        Atoms to include in the distance calculations\n\n    Returns\n    -------\n    time : np.ndarray\n        Time in ns\n    distance: np.ndarray\n        Closest distance between the two selections over time\n    \"\"\"\n\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n    transformation = _NoJump() # Account for PBC jumps\n    u.trajectory.add_transformations(transformation)\n\n    sel_str0 = f\"({selection_str}) and resid \" + \" \".join(str(r) for r in resids0)\n    sel_str1 = f\"({selection_str}) and resid \" + \" \".join(str(r) for r in resids1)\n\n    sel0 = u.select_atoms(sel_str0)\n    sel1 = u.select_atoms(sel_str1)\n\n    if sel0.n_atoms == 0:\n        raise ValueError('Selection 0 is empty!')\n    if sel1.n_atoms == 0:\n        raise ValueError('Selection 1 is empty!')\n\n    distances = []\n    time = []\n\n    for ts in _tqdm(u.trajectory, desc='Frames analysed'):\n        # Compute all pairwise distances (residue atoms vs ligand atoms)\n        d = _distance_array(sel0.positions, sel1.positions)\n\n        # Store the minimum distance for this frame\n        distances.append(d.min())\n        time.append(ts.time)\n\n    return 1e-3*_np.array(time), _np.array(distances)\n</code></pre>"},{"location":"reference/#ustraj.calc_hbond_distance","title":"calc_hbond_distance","text":"<pre><code>calc_hbond_distance(\n    donor_id,\n    acceptor_id,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    donor_selection=None,\n    acceptor_selection=None,\n)\n</code></pre> <p>Calculate closest distance between two sets of residues</p>"},{"location":"reference/#ustraj.calc_hbond_distance--parameters","title":"Parameters","text":"<p>donor_id : int     Index of the donor residue acceptor_id : int     Index of the acceptor residue prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. run_number : int     The desired replicate CV0 : float     The US bias minimum donor_selection : str, optional, default=None     Additional selection string, e.g. 'not name H' acceptor_selection : str, optional, default=None     Additional selection string, e.g. 'not name O'</p>"},{"location":"reference/#ustraj.calc_hbond_distance--returns","title":"Returns","text":"<p>time : np.ndarray     Time in ns distance: np.ndarray     Closest distance between the donor and acceptor atoms over time</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def calc_hbond_distance(\n    donor_id,\n    acceptor_id,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    donor_selection=None,\n    acceptor_selection=None\n):\n    \"\"\"\n    Calculate closest distance between two sets of residues\n\n    Parameters\n    ----------\n    donor_id : int\n        Index of the donor residue\n    acceptor_id : int\n        Index of the acceptor residue\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    run_number : int\n        The desired replicate\n    CV0 : float\n        The US bias minimum\n    donor_selection : str, optional, default=None\n        Additional selection string, e.g. 'not name H'\n    acceptor_selection : str, optional, default=None\n        Additional selection string, e.g. 'not name O'\n\n    Returns\n    -------\n    time : np.ndarray\n        Time in ns\n    distance: np.ndarray\n        Closest distance between the donor and acceptor atoms over time\n    \"\"\"\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n    transformation = _NoJump() # Account for PBC jumps\n    u.trajectory.add_transformations(transformation)\n\n    donor_sel = f\"resid {donor_id} and (name H*)\"\n    acceptor_sel = f\"resid {acceptor_id} and (name O* or name N* or name S*)\"\n\n    if donor_selection is not None:\n        donor_sel += f\" and ({donor_selection})\"\n    if acceptor_selection is not None:\n        acceptor_sel += f\" and ({acceptor_selection})\"\n\n    donors = u.select_atoms(donor_sel)\n    acceptors = u.select_atoms(acceptor_sel)\n\n    if donors.n_atoms == 0:\n        raise ValueError('Donor selection is empty!')\n    if acceptors.n_atoms == 0:\n        raise ValueError('Acceptor selection is empty!')\n\n    distances = []\n    time = []\n\n    for ts in _tqdm(u.trajectory, desc='Frames analysed'):\n        # Compute all pairwise distances (residue atoms vs ligand atoms)\n        d = _distance_array(donors.positions, acceptors.positions)\n\n        # Store the minimum distance for this frame\n        distances.append(d.min())\n        time.append(ts.time)\n\n    return 1e-3*_np.array(time), _np.array(distances)\n</code></pre>"},{"location":"reference/SUMMARY/","title":"SUMMARY","text":"<ul> <li>ustraj<ul> <li>analysis</li> </ul> </li> </ul>"},{"location":"reference/analysis/","title":"analysis","text":""},{"location":"reference/analysis/#ustraj.analysis","title":"analysis","text":"<p>Functions to analyse US trajectory files</p> <p>Functions:</p> <ul> <li> <code>count_hbonds</code>             \u2013              <p>Calculate the number of hydrogen bonds formed to a specific residue during</p> </li> <li> <code>calc_solvent_rdf</code>             \u2013              <p>Calculate the solvent RDF around an atom of interest</p> </li> <li> <code>calc_RMSD</code>             \u2013              <p>Calculate the RMSD for a region of interest</p> </li> <li> <code>calc_closest_distance</code>             \u2013              <p>Calculate closest distance between two sets of residues</p> </li> <li> <code>calc_hbond_distance</code>             \u2013              <p>Calculate closest distance between two sets of residues</p> </li> </ul>"},{"location":"reference/analysis/#ustraj.analysis.count_hbonds","title":"count_hbonds","text":"<pre><code>count_hbonds(\n    residue_index,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    sidechain_only=True,\n    step=10,\n    solvent_only=False,\n)\n</code></pre> <p>Calculate the number of hydrogen bonds formed to a specific residue during the course of a certain trajectory file.</p>"},{"location":"reference/analysis/#ustraj.analysis.count_hbonds--parameters","title":"Parameters","text":"<p>residue_index : int     Residue of interest for hydrogen bonding analysis prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. run_number : int     The desired replicate CV0 : float     The US bias minimum sidechain_only : bool, optional, default=True     Only use the sidechain of the residue step : int, optional, default=10     Step to use when analysing the frames, makes analysis quicker solvent_only: bool, optional, default=False     Only consider H-bonding to solvent</p>"},{"location":"reference/analysis/#ustraj.analysis.count_hbonds--returns","title":"Returns","text":"<p>donor_data: dict     Dictionary containing information about the residue of interest being     involved as a hydrogen bond donor. acceptor_data: dict     Dictionary containing information about the residue of interest being     involved as a hydrogen bond acceptor.</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def count_hbonds(\n    residue_index,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    sidechain_only=True,\n    step=10,\n    solvent_only=False,\n):\n    \"\"\"\n    Calculate the number of hydrogen bonds formed to a specific residue during\n    the course of a certain trajectory file.\n\n    Parameters\n    ----------\n    residue_index : int\n        Residue of interest for hydrogen bonding analysis\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    run_number : int\n        The desired replicate\n    CV0 : float\n        The US bias minimum\n    sidechain_only : bool, optional, default=True\n        Only use the sidechain of the residue\n    step : int, optional, default=10\n        Step to use when analysing the frames, makes analysis quicker\n    solvent_only: bool, optional, default=False\n        Only consider H-bonding to solvent\n\n    Returns\n    -------\n    donor_data: dict\n        Dictionary containing information about the residue of interest being\n        involved as a hydrogen bond donor.\n    acceptor_data: dict\n        Dictionary containing information about the residue of interest being\n        involved as a hydrogen bond acceptor.\n\n    \"\"\"\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n\n    water_sel = \"resname WAT\"\n    res_id = f\"resid {residue_index}\"\n\n    # residue atoms to consider (sidechain vs whole residue)\n    res_sel = f\"({res_id}) and not backbone\" if sidechain_only else f\"({res_id})\"\n\n    partner_sel = (\n        f\"not ({res_id})\"  # exclude the whole residue regardless of sidechain_only\n    )\n\n    # Residue acting as donor\n    hydrogens0 = f\"({res_sel}) and name H*\"\n    acceptors0 = f\"({partner_sel}) and (name O* or name N* or name S*)\"\n\n    # Residue acting as acceptor\n    hydrogens1 = f\"({partner_sel}) and name H*\"\n    acceptors1 = f\"({res_sel}) and (name O* or name N* or name S*)\"\n\n    if solvent_only:\n        acceptors0 += f\" and ({water_sel})\"\n        hydrogens1 += f\" and ({water_sel})\"\n\n    # Identify possible donor interactions\n    h0 = _HBA(\n        u,\n        hydrogens_sel=hydrogens0,\n        acceptors_sel=acceptors0,\n    )\n    h0.run(start=0, stop=None, step=step, verbose=True)\n\n    # Identify possible acceptor interactions\n    h1 = _HBA(\n        u,\n        hydrogens_sel=hydrogens1,\n        acceptors_sel=acceptors1,\n    )\n    h1.run(start=0, stop=None, step=step, verbose=True)\n\n    # Find simulation time\n    t_final = _np.round(u.trajectory[-1].time / 1000, 4)\n    time = _np.linspace(0, t_final, len(h0.count_by_time()))\n\n    donor_data = {\n        \"Time (ns)\": time,\n        \"Count by time\": h0.count_by_time(),\n        \"Count by ID\": h0.count_by_ids(),\n        \"Count by type\": h0.count_by_type(),\n    }\n\n    acceptor_data = {\n        \"Time (ns)\": time,\n        \"Count by time\": h1.count_by_time(),\n        \"Count by ID\": h1.count_by_ids(),\n        \"Count by type\": h1.count_by_type(),\n    }\n\n    return donor_data, acceptor_data\n</code></pre>"},{"location":"reference/analysis/#ustraj.analysis.calc_solvent_rdf","title":"calc_solvent_rdf","text":"<pre><code>calc_solvent_rdf(\n    atom_index,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    step=10,\n)\n</code></pre> <p>Calculate the solvent RDF around an atom of interest</p>"},{"location":"reference/analysis/#ustraj.analysis.calc_solvent_rdf--parameters","title":"Parameters","text":"<p>atom_index : int     Atom used to compute the RDF prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. run_number : int     The desired replicate CV0 : float     The US bias minimum step : int, optional, default=10     Step to use when analysing the frames, makes analysis quicker</p>"},{"location":"reference/analysis/#ustraj.analysis.calc_solvent_rdf--returns","title":"Returns","text":"<p>distance : np.ndarray     Radial separation distance in Angstroms rdf: np.ndarray     Normalised RDF around the specified atom</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def calc_solvent_rdf(\n    atom_index,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    step=10,\n):\n    \"\"\"\n    Calculate the solvent RDF around an atom of interest\n\n    Parameters\n    ----------\n    atom_index : int\n        Atom used to compute the RDF\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    run_number : int\n        The desired replicate\n    CV0 : float\n        The US bias minimum\n    step : int, optional, default=10\n        Step to use when analysing the frames, makes analysis quicker\n\n    Returns\n    -------\n    distance : np.ndarray\n        Radial separation distance in Angstroms\n    rdf: np.ndarray\n        Normalised RDF around the specified atom\n\n    \"\"\"\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n\n    selected_atom = u.select_atoms(f\"index {atom_index}\")\n    solvent = u.select_atoms(\"resname WAT\")\n\n    rdf = _InterRDF(selected_atom, solvent)\n    rdf.run(step=step, verbose=True)\n\n    return rdf.bins, rdf.rdf\n</code></pre>"},{"location":"reference/analysis/#ustraj.analysis.calc_RMSD","title":"calc_RMSD","text":"<pre><code>calc_RMSD(\n    resid_selection,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    step=1,\n    selection_str=\"backbone\",\n    u_ref=None,\n)\n</code></pre> <p>Calculate the RMSD for a region of interest</p>"},{"location":"reference/analysis/#ustraj.analysis.calc_RMSD--parameters","title":"Parameters","text":"<p>resid_selection : np.ndarray     Selection of residue indices to include in the RMSD calculation prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. run_number : int     The desired replicate CV0 : float     The US bias minimum step : int, optional, default=1     Step to use when analysing the frames, makes analysis quicker selection_str : str, optional, default='backbone'     Atoms to include during alignment and RMSD calculation u_ref : mda.Universe object, optional, default=None     Reference universe to use for alignment and RMSD calculation.     If 'None' is specified, the first frame is used</p>"},{"location":"reference/analysis/#ustraj.analysis.calc_RMSD--returns","title":"Returns","text":"<p>time : np.ndarray     Time in ns rmsd: np.ndarray     RMSD as a timeseries</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def calc_RMSD(\n    resid_selection,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    step=1,\n    selection_str='backbone',\n    u_ref=None\n):\n    \"\"\"\n    Calculate the RMSD for a region of interest\n\n    Parameters\n    ----------\n    resid_selection : np.ndarray\n        Selection of residue indices to include in the RMSD calculation\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    run_number : int\n        The desired replicate\n    CV0 : float\n        The US bias minimum\n    step : int, optional, default=1\n        Step to use when analysing the frames, makes analysis quicker\n    selection_str : str, optional, default='backbone'\n        Atoms to include during alignment and RMSD calculation\n    u_ref : mda.Universe object, optional, default=None\n        Reference universe to use for alignment and RMSD calculation.\n        If 'None' is specified, the first frame is used\n\n    Returns\n    -------\n    time : np.ndarray\n        Time in ns\n    rmsd: np.ndarray\n        RMSD as a timeseries\n    \"\"\"\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n\n    # Add specific residue indices to selection string\n    selection_str += \" and resid \" + \" \".join(str(r) for r in resid_selection)\n\n    selection = u.select_atoms(selection_str)\n\n    if u_ref is not None:\n        ref = u_ref.select_atoms(selection_str)\n        if ref.n_atoms != selection.n_atoms:\n            raise ValueError(\n                \"Reference and mobile selections have different number of atoms.\"\n            )\n    else:\n        ref = selection\n\n    R = _rms.RMSD(selection, ref,\n    superposition=True)\n\n    R.run(step=step)\n\n    rmsd = R.rmsd.T # transpose\n\n    return rmsd[1]/1000, rmsd[2] # time in ns, rmsd\n</code></pre>"},{"location":"reference/analysis/#ustraj.analysis.calc_closest_distance","title":"calc_closest_distance","text":"<pre><code>calc_closest_distance(\n    resids0,\n    resids1,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    selection_str=\"name CA\",\n)\n</code></pre> <p>Calculate closest distance between two sets of residues</p>"},{"location":"reference/analysis/#ustraj.analysis.calc_closest_distance--parameters","title":"Parameters","text":"<p>resids0 : np.ndarray     Residue group 0 resids1 : np.ndarray     Residue group 1 prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. CV0 : float     The US bias minimum run_number : int     The desired replicate selection_str : str, optional, default='name CA'     Atoms to include in the distance calculations</p>"},{"location":"reference/analysis/#ustraj.analysis.calc_closest_distance--returns","title":"Returns","text":"<p>time : np.ndarray     Time in ns distance: np.ndarray     Closest distance between the two selections over time</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def calc_closest_distance(\n    resids0,\n    resids1,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    selection_str='name CA'\n):\n    \"\"\"\n    Calculate closest distance between two sets of residues\n\n    Parameters\n    ----------\n    resids0 : np.ndarray\n        Residue group 0\n    resids1 : np.ndarray\n        Residue group 1\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    CV0 : float\n        The US bias minimum\n    run_number : int\n        The desired replicate\n    selection_str : str, optional, default='name CA'\n        Atoms to include in the distance calculations\n\n    Returns\n    -------\n    time : np.ndarray\n        Time in ns\n    distance: np.ndarray\n        Closest distance between the two selections over time\n    \"\"\"\n\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n    transformation = _NoJump() # Account for PBC jumps\n    u.trajectory.add_transformations(transformation)\n\n    sel_str0 = f\"({selection_str}) and resid \" + \" \".join(str(r) for r in resids0)\n    sel_str1 = f\"({selection_str}) and resid \" + \" \".join(str(r) for r in resids1)\n\n    sel0 = u.select_atoms(sel_str0)\n    sel1 = u.select_atoms(sel_str1)\n\n    if sel0.n_atoms == 0:\n        raise ValueError('Selection 0 is empty!')\n    if sel1.n_atoms == 0:\n        raise ValueError('Selection 1 is empty!')\n\n    distances = []\n    time = []\n\n    for ts in _tqdm(u.trajectory, desc='Frames analysed'):\n        # Compute all pairwise distances (residue atoms vs ligand atoms)\n        d = _distance_array(sel0.positions, sel1.positions)\n\n        # Store the minimum distance for this frame\n        distances.append(d.min())\n        time.append(ts.time)\n\n    return 1e-3*_np.array(time), _np.array(distances)\n</code></pre>"},{"location":"reference/analysis/#ustraj.analysis.calc_hbond_distance","title":"calc_hbond_distance","text":"<pre><code>calc_hbond_distance(\n    donor_id,\n    acceptor_id,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    donor_selection=None,\n    acceptor_selection=None,\n)\n</code></pre> <p>Calculate closest distance between two sets of residues</p>"},{"location":"reference/analysis/#ustraj.analysis.calc_hbond_distance--parameters","title":"Parameters","text":"<p>donor_id : int     Index of the donor residue acceptor_id : int     Index of the acceptor residue prmtop_filepath : str     The filepath for the topology file corresponding to the desired trajectory free_energy_step : str     The desired type of US simulation. The options are 'separation',     'RMSD' or 'Boresch'. restraint_type : str     The type of RMSD restraints used. The options are 'CA' or 'backbone'. dof : str     The degree of freedom. For free_energy_step='Boresch', the options are     'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',     the options specify bound or bulk state, as well as the restrain order. run_number : int     The desired replicate CV0 : float     The US bias minimum donor_selection : str, optional, default=None     Additional selection string, e.g. 'not name H' acceptor_selection : str, optional, default=None     Additional selection string, e.g. 'not name O'</p>"},{"location":"reference/analysis/#ustraj.analysis.calc_hbond_distance--returns","title":"Returns","text":"<p>time : np.ndarray     Time in ns distance: np.ndarray     Closest distance between the donor and acceptor atoms over time</p> Source code in <code>ustraj/analysis.py</code> <pre><code>def calc_hbond_distance(\n    donor_id,\n    acceptor_id,\n    prmtop_filepath,\n    free_energy_step,\n    restraint_type,\n    dof,\n    run_number,\n    CV0,\n    donor_selection=None,\n    acceptor_selection=None\n):\n    \"\"\"\n    Calculate closest distance between two sets of residues\n\n    Parameters\n    ----------\n    donor_id : int\n        Index of the donor residue\n    acceptor_id : int\n        Index of the acceptor residue\n    prmtop_filepath : str\n        The filepath for the topology file corresponding to the desired trajectory\n    free_energy_step : str\n        The desired type of US simulation. The options are 'separation',\n        'RMSD' or 'Boresch'.\n    restraint_type : str\n        The type of RMSD restraints used. The options are 'CA' or 'backbone'.\n    dof : str\n        The degree of freedom. For free_energy_step='Boresch', the options are\n        'thetaA', 'thetaB', 'phiA', 'phiB', 'phiC'. For free_energy_step='RMSD',\n        the options specify bound or bulk state, as well as the restrain order.\n    run_number : int\n        The desired replicate\n    CV0 : float\n        The US bias minimum\n    donor_selection : str, optional, default=None\n        Additional selection string, e.g. 'not name H'\n    acceptor_selection : str, optional, default=None\n        Additional selection string, e.g. 'not name O'\n\n    Returns\n    -------\n    time : np.ndarray\n        Time in ns\n    distance: np.ndarray\n        Closest distance between the donor and acceptor atoms over time\n    \"\"\"\n    dcd_filepath = _get_filepath(free_energy_step, restraint_type, dof, run_number, CV0)\n\n    # Check provided topology file exists\n    if not _os.path.exists(prmtop_filepath):\n        raise FileNotFoundError(f\"No topology file found at '{prmtop_filepath}'!\")\n\n    u = _mda.Universe(prmtop_filepath, dcd_filepath)\n    transformation = _NoJump() # Account for PBC jumps\n    u.trajectory.add_transformations(transformation)\n\n    donor_sel = f\"resid {donor_id} and (name H*)\"\n    acceptor_sel = f\"resid {acceptor_id} and (name O* or name N* or name S*)\"\n\n    if donor_selection is not None:\n        donor_sel += f\" and ({donor_selection})\"\n    if acceptor_selection is not None:\n        acceptor_sel += f\" and ({acceptor_selection})\"\n\n    donors = u.select_atoms(donor_sel)\n    acceptors = u.select_atoms(acceptor_sel)\n\n    if donors.n_atoms == 0:\n        raise ValueError('Donor selection is empty!')\n    if acceptors.n_atoms == 0:\n        raise ValueError('Acceptor selection is empty!')\n\n    distances = []\n    time = []\n\n    for ts in _tqdm(u.trajectory, desc='Frames analysed'):\n        # Compute all pairwise distances (residue atoms vs ligand atoms)\n        d = _distance_array(donors.positions, acceptors.positions)\n\n        # Store the minimum distance for this frame\n        distances.append(d.min())\n        time.append(ts.time)\n\n    return 1e-3*_np.array(time), _np.array(distances)\n</code></pre>"}]}